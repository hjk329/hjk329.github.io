---
title:  "Next.jsì˜ API Routes"
categories: 
  - Next.js
tags:
  - API Routes
  - Serverless
toc: true
toc_sticky: true
toc_label: "API Routes"
share: true

---

## APIë€?
Application Programming Interfaceì˜ ì•½ìë¡œ ì‘ìš© í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤ë¼ëŠ” ëœ»ì´ë‹¤.  
ì»´í“¨í„°ë‚˜ ì»´í“¨í„° í”„ë¡œê·¸ë¨ì„ ì—°ê²°í•˜ëŠ” ì—­í• ì„ í•œë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´, ê³ ê°ì´ ì–´ë– í•œ ë°ì´í„°ë¥¼ ìš”ì²­í–ˆì„ë•Œ DBì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” í”„ë¡ íŠ¸ì—”ë“œê°€ ë°±ì—”ë“œì™€ ì—°ê²°ë˜ì–´ì•¼ í•˜ê³ , ë°±ì—”ë“œì—ì„œ ì œê³µí•´ì£¼ëŠ” APIë¥¼ í†µí•´ DBì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.   

## API Routes

Next.jsëŠ” ì„œë²„ì™€ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”`(Serverless, ì„œë²„ë¦¬ìŠ¤)` **API Routes**ë¥¼ ì œê³µí•œë‹¤.  
ì¦‰, ì¶”ê°€ì ìœ¼ë¡œ ë°±ì—”ë“œ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ì§€ ì•Šë”ë¼ë„ ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‚˜ë§Œì˜ APIë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ ğŸ˜²

`pages/api` í´ë” ë‚´ì˜ ëª¨ë“  íŒŒì¼ì€ `/api/*`ì— ë§¤í•‘ë˜ì–´ í˜ì´ì§€ ëŒ€ì‹  API ì—”ë“œí¬ì¸íŠ¸ë¡œ ì²˜ë¦¬ëœë‹¤.  
ì´ëŠ” ì„œë²„ì‚¬ì´ë“œ ë²ˆë“¤ì´ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ì¸¡ ë²ˆë“¤ ì‚¬ì´ì¦ˆë¥¼ ëŠ˜ë¦¬ì§€ ì•ŠëŠ”ë‹¤ê³  í•œë‹¤.  

ì•„ë˜ëŠ” 200 ì½”ë“œì™€ `{ name: 'John Doe' }` ë¼ëŠ” JSONì„ ë¦¬í„´í•˜ëŠ” APIë‹¤.  

```
// pages/api/user.js

export default function handler(req, res) {
  res.status(200).json({ name: 'John Doe' })
}
```

ìœ„ ì˜ˆì œ ì½”ë“œì²˜ëŸ¼ `API Route` ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì¼ëª… `request handler` ë¼ê³  í•˜ëŠ” default functionì„ exportí•´ì•¼ í•œë‹¤.  
request handlerëŠ” `req`, `res` ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë°›ëŠ”ë‹¤.    

### ì‹¤ìŠµ
ë™ë¬¼ì— ëŒ€í•œ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë‚˜ë§Œì˜ APIë¥¼ ë§Œë“¤ì–´ ë³´ì•˜ë‹¤!  

#### ëª© ë°ì´í„° ìƒì„±í•˜ê¸°

DBë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë¥¼ ì•„ë˜ì™€ ê°™ì´ js íŒŒì¼ë¡œ ìƒì„±ë‹¤.  

 ```
 // src/data/index.js
 
 export const animals = [
    {
        id: '1',
        name: 'ëŒ•ëŒ•ì´',
        mbti: 'ENFP',
        age: 4,
        imgSrc: 'https://images.unsplash.com/photo-1608831540955-35094d48694a?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8ODN8fHB1cHB5fGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=800&q=60'
    },
    {
        id: '2',
        name: 'ì• ì˜¹ì´',
        mbti: 'INTJ',
        age: 1,
        imgSrc: 'https://images.unsplash.com/photo-1595433707802-6b2626ef1c91?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8a2l0dGVufGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=800&q=60',
    },
    {
        id: '3',
        name: 'ë‹¤ëŒì´',
        mbti: 'ISFP',
        imgSrc: 'https://images.unsplash.com/photo-1507666405895-422eee7d517f?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8M3x8JUVCJThCJUE0JUVCJTlFJThDJUVDJUE1JTkwfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=800&q=60'
    },
    {
        id: '4',
        name: 'ê³°ê³°ì´',
        mbti: 'ENTJ',
        imgSrc: 'https://images.unsplash.com/photo-1589656966895-2f33e7653819?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8cG9sYXIlMjBiZWFyfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=800&q=60'
    },
    {
        id: '5',
        name: 'ì§¹ì§¹ì´',
        mbti: 'ESFP',
        imgSrc: 'https://images.unsplash.com/photo-1620694563886-c3a80ec55f41?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MzV8fGJpcmR8ZW58MHx8MHx8&auto=format&fit=crop&w=800&q=60'
    },
    {
        id: '6',
        name: 'í† ì‹¬ì´',
        mbti: 'INFP',
        imgSrc: 'https://images.unsplash.com/photo-1596982061417-3a686a450552?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTJ8fHJhYmJpdHxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=800&q=60'
    },
    {
        id: '7',
        name: 'ë‹¤ì´ë…¸',
        mbti: 'ESTJ',
        imgSrc: 'https://images.unsplash.com/photo-1584844115436-473887b1e327?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTV8fCVFQSVCMyVCNSVFQiVBMyVBMXxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=800&q=60'
    }
]
 ```

#### pages/api ì— í•¸ë“¤ëŸ¬ ìƒì„±í•˜ê¸°
ê·¸ë¦¬ê³  `pages/api/animals` ë””ë ‰í† ë¦¬ì— ì•„ë˜ì™€ ê°™ì´ í•¸ë“¤ëŸ¬ë¥¼ ìƒì„±ë‹¤.  
 
``` 
import { animals } from "../../src/data";

export default function handler(req, res){
    return res.status(200).json(animals)
}
 ```
 
<br>

 
ë™ë¬¼ì— ë¶€ì—¬í•œ ê³ ìœ í•œ idë¡œ í•´ë‹¹ ë™ë¬¼ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ `pages/api/animals/[id].js` ë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•´ì„œ í•¸ë“¤ëŸ¬ë¥¼ ì‘ì„±í–ˆë‹¤.  

```
import { animals } from "../../src/data";

export default function animalsHandler(req, res){
    const {query} = req;
    const {id} = query;
    const animal = animals.find(({animal}) => animal.id === id);

    return animal? res.status(200).json(animal) : res.status(404).json({message: `${id} NOT FOUND`})  
}
``` 


ì°¸ê³ ë¡œ `req.query` ëŠ” ê¸°ë³¸ê°’ì´ {}ë¡œ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì„ í¬í•¨í•˜ëŠ” ê°ì²´ì´ë‹¤.  


#### í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ì¶œí•˜ê¸°
 
ì´ì œ ë°ì´í„°ì™€ APIëŠ” ì¤€ë¹„ë˜ì—ˆìœ¼ë‹ˆ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ì¶œì„ í•´ë³´ìŸˆ!  

```
// pages/animals/index.jsx

import Link from "next/link";
import { useEffect } from "react";
import useSWR from 'swr';
import AnimalPage from "./[id]";

const fetcher = (url) => fetch(url).then((res) => res.json());

const AnimalsPage = () => {
    const {data, error, isLoading} = useSWR('/api/animals', fetcher);

    if(error) return <p>ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>;
    if(isLoading) return <p>ë¡œë”©ì¤‘ì…ë‹ˆë‹¤ ...</p>;
    if(!data) return null;

    return (
        <ul>
            {
                data.map((animal) => <Link href={`/animals/${animal.id}`} key={animal.id} style={{display:'block'}}>{animal.name} ì •ë³´ ë” ë³´ê¸°</Link>)
            }
        </ul>
    )

}

export default AnimalsPage
```

<br>

ê°œë°œì ë„êµ¬ì˜ ë„¤íŠ¸ì›Œí¬ íŒ¨ë„ì—ì„œ í™•ì¸í•´ë³´ë©´ ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ì¡°íšŒëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤!   
![image](https://user-images.githubusercontent.com/84058944/222065553-e393d0b5-350d-492f-8808-0ba9edf20fcd.png)  

<br>


ê° ë™ë¬¼ì˜ ìƒì„¸ í˜ì´ì§€ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  

```
import { useRouter } from "next/router";
import useSWR from 'swr';

const fetcher = async (url) => {
    const res = await fetch(url);
    const data = await res.json();

    if(res.status !== 200) {
        throw new Error(data.message);
    }
    return data;
}

const AnimalPage = () => {
    const {query} = useRouter();
    const {data, error, isLoading, isValidating} = useSWR(() => (query.id ? `/api/animals/${query.id}` : null), fetcher);

    if(error) return <p>ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>;
    if(isLoading) return <p>ë¡œë”©ì¤‘ì…ë‹ˆë‹¤ ...</p>;
    if(!data) return null;

    return (
        <table>
            <thead>
                <tr>
                    <th>ì´ë¦„</th>
                     <th>MBTI</th>
                     <th>ì‚¬ì§„</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    {
                        isValidating ? 
                            <td>ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td> : 
                            <>
                            <td>{data.name}</td>
                            <td>{data.mbti}</td>
                            <td><img src={data.imgSrc} alt="animal_photo" width={200} height={200} style={{borderRadius:'50%'}} /></td>
                            </>
                        
                    }
                </tr>
            </tbody>
        </table>
    )

}

export default AnimalPage;
```
<br>

ê° ìƒì„¸ í˜ì´ì§€ë„ ì •ìƒì ìœ¼ë¡œ ì¡°íšŒëœë‹¤.  

![image](https://user-images.githubusercontent.com/84058944/222066169-b1ba447d-3426-4fde-b0b6-6bfc8fb12f4d.png)  
